---
title: "Prediction of Infectious Disease Epidemics via Adaptively Weighted Ensembles"
author: "Evan L Ray, Krzysztof Sakrejda, Nicholas G Reich"
date: "January 2017"
output: pdf_document
---


## Abstract


## Introduction

1 paragraph big picture intro to prediction in infectious disease context

The observation that motivated the development of the method presented in this manuscript was seeing how certain prediction models for infectious disease consistently performed better than other models at certain times of year. We set out to determine whether we past model performance could inform dynamic and adaptive model weights in an ensemble prediction framework. We observed that early in the US influenza season, simple models of historical incidence often outperformed more standard time-series prediction models such as a seasonal auto-regressive integrated moving average (SARIMA) model. However, in the middle of the season, the time-series models showed improved accuracy.

Using seasonal influenza outbreaks in the US health regions as a case-study, we developed and applied an adaptively weighted ensemble model to predicting several features of the influenza season at each week during the season. Specifically, we aimed to predict three  values defined by the US Centers for Disease Control and Prevention (US CDC) that define important features of an epidemic season: 

 1. onset week: the week at which the incidence first exceeds and remains above a region-specific threshold,
 2. peak week: the week at which the maximum incidence for the season is observed,
 3. peak incidence: the maximum observed weighted influenza-like illness (wILI) measure in a season.



## Methods

### Data

### Component models
We used three component models to generate predictions of these quantities of interest. The first model was a seasonal average model that utilized kernel density estimation to estimate a predictive distribution for each target. The second model utilized kernel conditional density estimation to create predicted trajectories of incidence. By aggregating across all trajectories, we constructed predictive distributions for each target. The third model used a standard SARIMA implementation and model selection approach to fit a seasonal auto-regressive model to the data.

 1) A "fixed" model using either Kernel Density Estimation (for season onset week, season peak week, and season peak incidence), or a GAM (for predictions of incidence at horizons 1 to 4 weeks).  The predictions from this model do not change as new data are observed over the course of the season (though the predictions for incidence in individual weeks do depend on the week being predicted), and can be interpreted as a representation of "everything that we have seen in the past".  A separate model fit is obtained for each region. [[include trunc KDE?: Model number 1 in the original description (below) has been modified to truncate the predictive distributions for onset timing, peak timing, and peak incidence so that values that have been eliminated by previously observed incidence are assigned low probability.  This is done in a very ad hoc manner.  The predictive distribution for the remaining bins is scaled up so that the sum of the predictive probability assigned to all bins equals 1.]]

 2) A model combining Kernel Conditional Density Estimation (KCDE) and copulas.  KCDE is used to obtain separate predictive densities for each future week in the season.  In order to predict seasonal quantities (onset, peak timing, and peak incidence), we use a copula to model dependence among those individual predicitive densities, thereby obtaining a joint predicitive density for incidence in all future weeks.  Predicitive densities for the seasonal quantities can be obtained as appropriate integrals of this joint density.  A separate model fit is obtained for each region.

 3) A SARIMA model.  This model is fit to seasonally differenced log(weighted_ili) using a stepwise procedure to select the model specification.  A separate model fit is obtained for each region.

### Ensemble model framework

The final predictions are obtained as a linear combination of the predictions from these component models.  The model weights depend on the week of the season in which the predictions are made.  We represent these weights as the softmax transformation of latent functions rho_ilt(season week) where i = 1, ..., 3 indexes the component model, l = 1, ..., 11 indexes the location (national or region 1 through 10), and t = 1, ..., 7 indexes the prediction target.  We estimate those latent functions rho_ilt via gradient tree boosting, optimizing leave-one-season-out crossvalidated log scores (using the definition of log scores specified for this competition).

We have introduced regularization into our model weighting scheme, which uses gradient tree boosting.  For now, weight regularization is done through three parameters; optimal values of those parameters are selected through cross-validation and a single best weighting scheme is selected.  The parameters are the depth of the regression trees used in the gradient tree boosting process, the number of boosting iterations, and the learning rate.

### Model training and cross-validation

### Model testing


## Results


## Conclusion

General ensemble framework (not just time-series or infectious disease) 

Future Directions

 - evaluation for weekly incidence
 - standardize method into object-oriented framework for easy model plug-n-play
 - more complex models
 - use model weights to infer predictive value of different data sources (climate, strain-specific info)
 
 
 
 
